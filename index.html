<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sconee Archive</title>
    <style>
        body { margin: 0; padding: 0; background-color: #121212; color: #ffffff; font-family: 'Helvetica Neue', sans-serif; }
        
        header { 
            height: 50vh; 
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        h1 { font-size: 3rem; margin-bottom: 10px; font-weight: 700; letter-spacing: 1px; }
        p { font-size: 1.2rem; color: #cccccc; }

        /* --- 3단 필터 스타일 --- */
        .filter-section { padding: 20px 40px; background-color: #1a1a1a; border-bottom: 1px solid #333; }
        .filter-row { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        .filter-label { width: 80px; font-size: 0.8rem; color: #666; font-weight: bold; text-transform: uppercase; }
        .filter-group { display: flex; gap: 8px; flex-wrap: wrap; }
        
        .filter-btn {
            background: #333; border: 1px solid #444; color: #ccc;
            padding: 6px 14px; border-radius: 15px; cursor: pointer; font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        .filter-btn:hover, .filter-btn.active { background: #fff; color: #000; border-color: #fff; }

        .gallery-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px; padding: 40px;
        }
        .gallery-item { background: #1e1e1e; border-radius: 8px; overflow: hidden; transition: transform 0.3s ease; }
        .gallery-item:hover { transform: translateY(-5px); }
        .gallery-item img { width: 100%; height: 250px; object-fit: cover; display: block; }
        .info { padding: 15px; }
        .info h3 { margin: 0 0 8px 0; font-size: 1.1rem; color: #fff; }
        .tags-row { display: flex; gap: 6px; flex-wrap: wrap; }
        .tag-badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 4px; color: #000; font-weight: 600; }
        .tag-space { background-color: #a8d5e2; } /* 파란색: 공간 */
        .tag-vibe { background-color: #e2a8a8; }  /* 빨간색: 분위기 */
        .tag-detail { background-color: #dbe2a8; } /* 노란색: 디테일 */
    </style>
</head>
<body>

    <header id="main-header">
        <h1>Sconee Archive</h1>
        <p>Curated Inspiration for Space & Design</p>
    </header>

    <div class="filter-section">
        <div class="filter-row">
            <span class="filter-label">Space</span>
            <div class="filter-group" id="filter-space">
                <button class="filter-btn active" onclick="filterGallery('space', 'all')">All</button>
            </div>
        </div>
        <div class="filter-row">
            <span class="filter-label">Vibe</span>
            <div class="filter-group" id="filter-vibe">
                <button class="filter-btn active" onclick="filterGallery('vibe', 'all')">All</button>
            </div>
        </div>
        <div class="filter-row">
            <span class="filter-label">Detail</span>
            <div class="filter-group" id="filter-detail">
                <button class="filter-btn active" onclick="filterGallery('detail', 'all')">All</button>
            </div>
        </div>
    </div>

    <div class="gallery-grid" id="gallery-grid"></div>

    <script>
        let allData = [];
        let currentFilters = { space: 'all', vibe: 'all', detail: 'all' };

        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                allData = data;
                if(data.length > 0) {
                    document.getElementById('main-header').style.backgroundImage = 
                        `linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.8)), url('${data[0].img}')`;
                }
                generateFilters(data);
                renderGallery(data);
            });

        function generateFilters(data) {
            const spaces = new Set();
            const vibes = new Set();
            const details = new Set();

            data.forEach(item => {
                // 새 데이터 형식(space/vibe/detail)과 옛날 형식(tags) 모두 처리
                if (item.space) spaces.add(item.space);
                if (item.vibe) vibes.add(item.vibe);
                if (item.detail) details.add(item.detail);
                
                // 옛날 데이터(tags 문자열) 처리 - 대충 Space로 넣어줌
                if (item.tags && !item.space) {
                    item.tags.split('|').forEach(t => spaces.add(t.trim()));
                }
            });

            createButtons('filter-space', spaces, 'space');
            createButtons('filter-vibe', vibes, 'vibe');
            createButtons('filter-detail', details, 'detail');
        }

        function createButtons(containerId, tagSet, type) {
            const container = document.getElementById(containerId);
            tagSet.forEach(tag => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.innerText = tag;
                btn.onclick = (e) => {
                    // 버튼 활성화 스타일
                    container.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    filterGallery(type, tag);
                };
                container.appendChild(btn);
            });
        }

        function filterGallery(type, value) {
            currentFilters[type] = value; // 선택한 필터 저장

            const filtered = allData.filter(item => {
                // 3가지 조건이 모두 맞아야 함 (AND 조건)
                const matchSpace = (currentFilters.space === 'all') || 
                                   (item.space === currentFilters.space) || 
                                   (item.tags && item.tags.includes(currentFilters.space));
                
                const matchVibe = (currentFilters.vibe === 'all') || 
                                  (item.vibe === currentFilters.vibe);
                
                const matchDetail = (currentFilters.detail === 'all') || 
                                    (item.detail === currentFilters.detail);

                return matchSpace && matchVibe && matchDetail;
            });

            renderGallery(filtered);
        }

        function renderGallery(items) {
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';
            
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'gallery-item';
                
                // 태그 뱃지 만들기
                let tagsHtml = '';
                if(item.space) tagsHtml += `<span class="tag-badge tag-space">${item.space}</span>`;
                if(item.vibe) tagsHtml += `<span class="tag-badge tag-vibe">${item.vibe}</span>`;
                if(item.detail) tagsHtml += `<span class="tag-badge tag-detail">${item.detail}</span>`;
                if(item.tags && !item.space) tagsHtml += `<span class="tag-badge tag-space">${item.tags}</span>`;

                div.innerHTML = `
                    <a href="${item.img}" target="_blank">
                        <img src="${item.img}" alt="${item.title}" loading="lazy">
                    </a>
                    <div class="info">
                        <h3>${item.title}</h3>
                        <div class="tags-row">${tagsHtml}</div>
                    </div>
                `;
                grid.appendChild(div);
            });
        }
    </script>
</body>
</html>